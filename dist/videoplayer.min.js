function _$(n){n.text=function(e){n.innerText=e},n.addClass=function(e){return addClass(n,e)},n.removeClass=function(e){return removeClass(n,e)},n.css=function(e,t){n.style[e]=t};var e=_getComputedStyle(n,"display");return n.olddisplay="none"===e||""===e?_defaultDisplay(n.nodeName):e,n.show=function(){if(n.style){var e=n.style.display;""!==e&&"none"!==e||(n.style.display=n.olddisplay)}},n.hide=function(){n.style.display="none"},n.click=function(e){n.addEventListener("click",e)},n}function addClass(e,t){var n,i,s,o;if(1===e.nodeType&&t&&"string"==typeof t)if(n=t.split(/\s+/),e.className||1!==n.length){for(o=" "+e.className+" ",i=0,s=n.length;i<s;i++)~o.indexOf(" "+n[i]+" ")||(o+=n[i]+" ");e.className=o.trim()}else e.className=t;return e}function removeClass(e,t){var n,i,s,o;if(1===e.nodeType&&e.className&&(t&&"string"==typeof t||void 0===t))if(n=(t||"").split(/\s+/),t){for(i=(" "+e.className+" ").replace(/[\n\t\r]/g," "),s=0,o=n.length;s<o;s++)i=i.replace(" "+n[s]+" "," ");e.className=i.trim()}else e.className="";return e}function hasClass(e,t){var n=" "+t+" ";return-1<(" "+e.className+" ").replace(/[\n\t\r]/g," ").indexOf(n)}function toggleClass(e,t){for(var n,i=0,s=t.split(/\s+/);n=s[i++];)(hasClass(e,n)?removeClass:addClass)(e,n);return e}var _getComputedStyle,t=function(e){return e<10?"0"+e.toString():e};function formatTime(e){var n="",i="",s="";return 0<e?(s=t(parseInt(e%60)),60<=e?(i=t(parseInt(e/60%60))+":",3600<=e&&(n=t(parseInt(e/3600%24))+":")):i="00:"):s="00:00",n+i+s}document.defaultView&&document.defaultView.getComputedStyle&&(_getComputedStyle=function(e,t){var n,i,s;e.style;return t=t.replace(/([A-Z]|^ms)/g,"-$1").toLowerCase(),(i=e.ownerDocument.defaultView)&&(s=i.getComputedStyle(e,null))&&(n=s.getPropertyValue(t)),n});var _elemdisplay={};function _defaultDisplay(e){if(!_elemdisplay[e]){var t=document.body,n=document.createElement(e);t.appendChild(n);var i=_getComputedStyle(n,"display");t.removeChild(n),_elemdisplay[e]=i}return _elemdisplay[e]}function VideoPlayer(e){this.setting=Object.assign({el:null,url:null,volume:1,autoplay:!1,loop:!1,mute:!1},e),this.init()}function VideoControl(e,t,n){this._options=n,this._onState=null,this._onMute=null,this._isFullScreen=!1,this._vp=e,this._video=t,this._playerTips=null,this._playing=null,this._waiting=null,this._replaying=null,this._playerControls=null,this._switchBtn=null,this._timeCurrent=null,this._timeDuration=null,this._processBar=null,this._processBuffer=null,this._processLine=null,this._muteBtn=null,this._fullScreenBtn=null}VideoPlayer.prototype.init=function(){this._vp=document.getElementById(this.setting.el),this._video=this._vp.querySelectorAll("video")[0],this.setting.url&&(this._video.src=this.setting.url),this.setting.poster&&(this._video.poster=this.setting.poster),1!=this.setting.volume&&(this._video.volume=this.setting.volume),this.setting.autoplay&&(this._video.autoplay=this.setting.autoplay),this.setting.loop&&(this._video.loop=this.setting.loop),this.setting.mute&&(this._video.mute=this.setting.mute),this.videoControl=new VideoControl(this._vp,this._video,this.setting),this.videoControl.init()},VideoControl.prototype={toggleFullScreenClasses:function(){this._fullScreenBtn.removeClass("fullscreen-off fullscreen-on"),this.fullScreen?this._fullScreenBtn.addClass("fullscreen-off"):this._fullScreenBtn.addClass("fullscreen-on")},set fullScreen(e){this._isFullScreen=e,this.toggleFullScreenClasses()},get fullScreen(){return this._isFullScreen},set onMute(e){this._onMute=e,this._muteBtn.removeClass("mute-off mute-on"),this._video.muted=e?(this._muteBtn.addClass("mute-on"),!0):(this._muteBtn.addClass("mute-off"),!1)},get onMute(){return this._onMute},set onState(e){"waiting"==(this._onState=e)?this.showWaiting():"playing"==e?this._switchBtn.removeClass("play pause").addClass("pause"):"pause"==e?this._switchBtn.removeClass("play pause").addClass("play"):"ended"==e&&(this.showEnded(),this._playerControls.show())},showPause:function(){},hidePause:function(){},showProcessBar:function(){},hideProcessBar:function(){},updateBar:function(){var e=parseInt(this._video.duration),t=parseInt(this._video.currentTime),n=t/e*100;this._processLine.css("width",n+"%"),this._timeCurrent.text(formatTime(t))},setProcess:function(e){this._processBuffer.css("width",e+"%")},seek:function(e){this._video.currentTime=e},toPlay:function(){this._video.play(),this._playing.hide()},toPause:function(){this._video.pause(),this._playing.show()},showWaiting:function(){this._waiting.show()},hideWaiting:function(){this._waiting.hide()},showWarning:function(){},togglePlay:function(){this._video.paused?this.toPlay():(this.toPause(),this.hideWaiting())},showEnded:function(){this._replaying.show()}},VideoControl.prototype.init=function(){var l=this;this._vp.addEventListener("mouseover",function(e){l._playerControls.show()}),this._vp.addEventListener("mouseout",function(e){null==l._onState||"pause"==l._onState||"ended"==l._onState||l._playerControls.hide()}),this._playerTips=this.getChildEle(".player-tips"),this._playerTips.click(function(e){e.stopPropagation(),"ended"==l._onState?(l.toPlay(),l._replaying.hide()):l.togglePlay()}),this._playing=this.getChildEle(".playing"),this._waiting=this.getChildEle(".waiting"),this._replaying=this.getChildEle(".replaying"),this._playerControls=this.getChildEle(".player-controls"),this._switchBtn=this.getChildEle(".switch"),this._switchBtn.click(function(e){e.stopPropagation(),"ended"==l._onState?(l.toPlay(),l._replaying.hide()):l.togglePlay()}),this._timeCurrent=this.getChildEle(".time-current"),this._timeCurrent.text(formatTime(0)),this._timeDuration=this.getChildEle(".time-duration"),this._timeDuration.text(formatTime(0)),this._processBar=this.getChildEle(".process-bar"),this._processBar.click(function(e){var t=e.offsetX,n=e.currentTarget.offsetWidth,i=t/n,s=l._video.duration,o=i*s;console.log(t,n,i,o,s),l.seek(o)}),this._processBuffer=this.getChildEle(".process-buffer"),this._processLine=this.getChildEle(".process-line"),this._muteBtn=this.getChildEle(".mute-btn"),this._muteBtn.click(function(e){e.stopPropagation(),l.onMute=!l.onMute}),this._fullScreenBtn=this.getChildEle(".fullscreen-btn"),this._fullScreenBtn.click(function(e){l.toggleFullScreen()}),["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","msfullscreenchange"].forEach(function(e){document.addEventListener(e,function(){l.fullScreen=!l.fullScreen})}),this.addVideoEvents(this._video),this.onMute=this._options.mute},VideoControl.prototype.addVideoEvents=function(n){var i=this;n.addEventListener("loadstart",function(){console.log("1、loadstart、客户端开始请求数据")},!1),n.addEventListener("durationchange",function(){console.log("2、durationchange、资源长度改变"),i._timeDuration.text(formatTime(n.duration))},!1),n.addEventListener("loadedmetadata",function(){console.log("3、loadedmetadata、")},!1),n.addEventListener("loadeddata",function(){console.log("4、loadeddata、")},!1),n.addEventListener("progress",function(){var e="5、progress、";if(4==n.readyState){var t=Math.round(n.buffered.end(0)/n.duration*100);e+="正在缓冲："+t+"%",i.setProcess(t)}console.log(e)},!1),n.addEventListener("canplay",function(){console.log("6、canplay、缓冲已足够开始时。-----每次卡住，再缓冲成功都会调用此方法"),i.hideWaiting(),i._playing.hide()},!1),n.addEventListener("canplaythrough",function(){console.log("7、canplaythrough、当媒介能够无需因缓冲而停止即可播放至结尾时运行的脚本。")},!1),n.addEventListener("waiting",function(){console.log("waiting,当媒介已停止播放但打算继续播放时（比如当媒介暂停已缓冲更多数据）运行脚本"),i.onState="waiting"},!1),n.addEventListener("play",function(){console.log("play,当媒介已就绪可以开始播放时运行的脚本。")},!1),n.addEventListener("playing",function(){console.log("playing,当媒介已开始播放时运行的脚本。-----加载提示影藏"),i.onState="playing"},!1),n.addEventListener("pause",function(){console.log("pause,当媒介被用户或程序暂停时运行的脚本。-----视频播放结束也会调用此方法"),i.onState="pause"},!1),n.addEventListener("ended",function(){console.log("ended,当媒介已到达结尾（可发送类似“感谢观看”之类的消息）。"),i.onState="ended",i.seek(0)},!1),n.addEventListener("suspend",function(){},!1),n.addEventListener("abort",function(){},!1),n.addEventListener("stalled",function(){},!1),n.addEventListener("seeking",function(){},!1),n.addEventListener("seeked",function(){},!1),n.addEventListener("ratechange",function(){},!1),n.addEventListener("volumechange",function(){},!1),n.addEventListener("timeupdate",function(){i.updateBar()},!1),n.addEventListener("error",this.videoError,!1)},VideoControl.prototype.toggleFullScreen=function(){if(this.fullScreen)document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():console.error("Unable to find a fullscreen exit method.");else{var e=this._vp;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():console.error("Unable to find a fullscreen request method")}},VideoControl.prototype.videoError=function(){var e={};switch(e.code=this._video.error.code,e.error="",e.code){case 1:e.error="播放过程中用户终止";break;case 2:e.error="播放过程中网络错误";break;case 3:e.error="播放过程中解码错误";break;case 4:e.error="播放过程中URL无效"}console.log(JSON.stringify(e)),this.showWarning()},VideoControl.prototype.getChildEle=function(e){return _$(e=this._vp.querySelector(e))};